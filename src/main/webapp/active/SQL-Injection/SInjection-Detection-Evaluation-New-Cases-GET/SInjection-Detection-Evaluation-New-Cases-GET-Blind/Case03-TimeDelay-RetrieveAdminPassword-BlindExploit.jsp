<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<%@page import="java.sql.*" %>
<%@page import="com.nsunina.wavsepenhancement.database.ConnectionPoolManager" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Case 3 - Injection into GET parameter to trigger conditional time delays to infer information. Goal: retrieve 'admin' password injecting in GET parameter.</title>
</head>
<body>
<%
Connection conn = null;
try {
    String msg = request.getParameter("msg");
	
    conn = ConnectionPoolManager.getConnection();
  
    System.out.print("Connection Opened Successfully\n");

   	String SqlString = 
      	  "SELECT title " +
	      "FROM messages " +
	      "WHERE message like'" + msg + "%'";
	Statement stmt = conn.createStatement();
	ResultSet rs = stmt.executeQuery(SqlString);
		
	out.flush();
		
	if(conn != null) {
     	ConnectionPoolManager.closeConnection(conn);
    }
		
  } catch (Exception e) {
      response.sendError(500, "Internal Server Error");
      
      if(!(e instanceof java.sql.SQLDataException)) {
	        System.out.println("Exception details: " + e);
 	 } 
	
		if(conn != null) {
	      	ConnectionPoolManager.closeConnection(conn);
	    }
	}
%>

</body>
</html>